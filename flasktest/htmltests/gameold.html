{% extends "layout.html" %}

{% block headscript %}
{% endblock %}

{% block title %}
    Portofolio
{% endblock %}

{% block main %}
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        var mousePressed = false;
        var lastX, lastY;
        var ctx;

        function InitThis() {
            ctx = document.getElementById('myCanvas').getContext("2d");

            $('#myCanvas').mousedown(function (e) {
                mousePressed = true;
                Draw(e.pageX - $(this).offset().left, e.pageY - $(this).offset().top, false);
            });

            $('#myCanvas').mousemove(function (e) {
                if (mousePressed) {
                    Draw(e.pageX - $(this).offset().left, e.pageY - $(this).offset().top, true);
                }
            });

            $('#myCanvas').mouseup(function (e) {
                mousePressed = false;
            });
        	    $('#myCanvas').mouseleave(function (e) {
                mousePressed = false;
            });
        }

        function Draw(x, y, isDown) {
            if (isDown) {
                ctx.beginPath();
                ctx.strokeStyle = $('#selColor').val();
                ctx.lineWidth = $('#selWidth').val();
                ctx.lineJoin = "round";
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.closePath();
                ctx.stroke();
            }
            lastX = x; lastY = y;
        }

        function clearArea() {
            // Use the identity matrix while clearing the canvas
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        }

    </script>
    <div id="gameinfo">
        <h2>Lobby Page</h2>
    </div>
    <div id="wrapper">
        <div id="drawing">
            <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
            <div align="center">
                <canvas id="myCanvas" width= 1000px height= 600px></canvas>
                <br /><br />
                <button class="canvasoption" onclick="javascript:clearArea();return false;">Clear Area</button>
                <button id="publishbtn" class="canvasoption"> Publish </button>
                Line width : <select class="canvasoption" id="selWidth">
                    <option value="1">1</option>
                    <option value="3">3</option>
                    <option value="5">5</option>
                    <option value="7">7</option>
                    <option value="9" selected="selected">9</option>
                    <option value="11">11</option>
                </select>
                Color : <select class="canvasoption" id="selColor">
                    <option value="black">black</option>
                    <option value="blue" selected="selected">blue</option>
                    <option value="red">red</option>
                    <option value="green">green</option>
                    <option value="yellow">yellow</option>
                    <option value="gray">gray</option>
                </select>
            </div>
        </div>
        <div id="chat">
            <form id="chatform" action="">
                <input id="chatbox" autocomplete="off" /><button id="chatbutton">Send</button>
            </form>
            <ul id="messages"></ul>
        </div>
    </div>
    <div id="qanda">
        <h2>Question area</h2>
    </div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">
    var socket = io();

    $('form').submit(function(e){
        e.preventDefault(); // prevents page reloading
        socket.emit('chat message', $('#chatbox').val());
        $('#chatbox').val('');
        return false;
    });

    document.getElementById("publishbtn").addEventListener("click", function(){
        var canvas = document.getElementById('myCanvas');
        var pic = canvas.toDataURL();
        socket.emit('picture', pic)
    });

    socket.on('user message', function(message){
        $('#messages').prepend($('<li>').text(message));
    });

    socket.on('picture', function(message){
        var myCanvas = document.getElementById('myCanvas');
        var ctx = myCanvas.getContext('2d');
        var img = new Image;
        img.onload = function(){
            ctx.drawImage(img,0,0);
        };
        img.src = message;
    });

    </script>
{% endblock %}
